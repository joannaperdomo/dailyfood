<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Comidas</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2em auto; }
    label { display: block; margin-top: 1em; }
    input, select, textarea { width: 100%; padding: 0.5em; margin-top: 0.2em; }
    .hidden { display: none; }
    .nuevo-section { border: 1px solid #ccc; padding: 1em; margin-top: 1em; background: #f9f9f9; }
    button { margin-top: 2em; padding: 0.7em 1.5em; }
  </style>
</head>
<body>

  <h2>Registro de Comidas</h2>

  <form id="foodForm">
    <!-- Comida -->
    <label>Comida:</label>
    <label><input type="radio" name="comida" value="Desayuno" required> Desayuno</label>
    <label><input type="radio" name="comida" value="Comida"> Comida</label>
    <label><input type="radio" name="comida" value="Almuerzo"> Almuerzo</label>
    <label><input type="radio" name="comida" value="Cena"> Cena</label>

    <!-- Nombre -->
    <label for="nombre">Nombre:</label>
    <select id="nombre" name="nombre" required>
      <option value="" disabled selected>Seleccione un alimento</option>
      <!-- Items will be dynamically populated here -->
    </select>

    <!-- Porción -->
    <label for="porcion">Porción (g):</label>
    <input type="number" step="0.01" name="porcion" id="porcion" required>

    <!-- Campos adicionales si es "Nuevo" -->
    <div id="nuevoFields" class="nuevo-section hidden">
      <h4>Nuevo alimento</h4>
      <label for="descripcion">Descripción porción:</label>
      <input type="text" name="descripcion" id="descripcion">

      <label for="calorias">Calorías:</label>
      <input type="number" step="0.01" name="calorias" id="calorias">

      <label for="proteina">Proteína:</label>
      <input type="number" step="0.01" name="proteina" id="proteina">

      <label for="grasa">Grasa:</label>
      <input type="number" step="0.01" name="grasa" id="grasa">

      <label for="carbohidratos">Carbohidratos:</label>
      <input type="number" step="0.01" name="carbohidratos" id="carbohidratos">

      <label for="fibra">Fibra:</label>
      <input type="number" step="0.01" name="fibra" id="fibra">
    </div>

    <button type="submit">Enviar</button>
  </form>

  <script>
    const nombreSelect = document.getElementById("nombre");
    const nuevoFields = document.getElementById("nuevoFields");

    // Populate dropdown
    function populateItems(items) {
      items.forEach(item => {
        const option = document.createElement("option");
        option.value = item;
        option.textContent = item;
        nombreSelect.appendChild(option);
      });

      // Add "Nuevo" option
      const nuevoOption = document.createElement("option");
      nuevoOption.value = "Nuevo";
      nuevoOption.textContent = "Nuevo";
      nombreSelect.appendChild(nuevoOption);
    }

    // Show/hide extra fields based on selection
    nombreSelect.addEventListener("change", () => {
      if (nombreSelect.value === "Nuevo") {
        nuevoFields.classList.remove("hidden");
      } else {
        nuevoFields.classList.add("hidden");
      }
    });

    // Handle form submission
    document.getElementById("foodForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const data = Object.fromEntries(formData.entries());

      // Add today's date in dd/mm/yyyy format
      const today = new Date();
      data.fecha = today.toLocaleDateString("es-ES");

      // Optional: validate if "Nuevo" fields are filled
      if (data.nombre === "Nuevo") {
        const requiredFields = ["descripcion", "calorias", "proteina", "grasa", "carbohidratos", "fibra"];
        for (const field of requiredFields) {
          if (!data[field]) {
            alert(`Por favor completa el campo: ${field}`);
            return;
          }
        }
      }

      console.log("DATA TO SUBMIT:", data);

      // 🔗 Send data to your Google Apps Script here
      // fetch("https://script.google.com/macros/s/AKfycbxxEQ2wq_UkFrVY4x1vIzb3I72FBn5ieUJsfJqwbAdxDTy3LjWkDcb23bIvk-jArp4/exec", {
      //   method: "POST",
      //   headers: { "Content-Type": "application/json" },
      //   body: JSON.stringify(data)
      // })
      // .then(res => res.text())
      // .then(response => {
      //   alert("Datos enviados correctamente.");
      //   location.reload();
      // })
      // .catch(err => alert("Error al enviar: " + err));
    });
  </script>
  <script src="main.js"></script>
</body>
</html>
